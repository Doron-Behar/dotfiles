# create a simpler and lighter cd fzf completion
_fzf_complete_cd() {
	if [[ -z "${prefix}" ]]; then
		prefix="./"
	fi
	local dirs=(${prefix}*(-/)) 2> /dev/null
	[ ! -z "${dirs}" ] && \
	_fzf_complete +m "$@" < <(
		IFS=$'\n'; printf '%s\n' "${dirs[*]}"
	)
}

# this will remove trailing whitespaces and add instead a /
_fzf_complete_cd_post() {
	match="$(cat -)"
	if [[ ! -z "$match" ]]; then
		printf '%q' "${match#[[:space:]]*}"/
	fi
}

# use the same completion of cd for lf the file manager
_fzf_complete_lf() {
	_fzf_complete_cd "$@"
}
_fzf_complete_lf_post() {
	_fzf_complete_cd_post "$@"
}

# gopass or pass passwords
_fzf_complete_gopass() {
    _fzf_complete "--query '$prefix'" "$@" < <(
		find -L ~/.password-store -name '.git*' -prune -o -type f -printf '%P\n' | sed 's/.gpg$//'
	)
}
_fzf_complete_pass() {
    _fzf_complete "--query '$prefix'" "$@" < <(
		find -L ~/.password-store -name '.git*' -prune -o -type f -printf '%P\n' | sed 's/.gpg$//'
	)
}
