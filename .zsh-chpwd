# `task context` wrapper with support for env variable TCS silencing it.
_task_context(){
	if [[ -z "$1" ]]; then
		_task_context_default
	else
		if [[ -z $TCS ]]; then
			task context "$@"
		elif [[ $TCS == 1 ]]; then
			task context "$@" > /dev/null
		else
			task context "$@" &> /dev/null
		fi
	fi
}

function _contexts_parser() {
	local line name directories dir
	while IFS="$DEFAULT_IFS" read line; do
		if [[ ! "$line" =~ "context\.[-_a-zA-Z0-9]*=.*\# " ]]; then
			continue
		fi
		name="${${line#context.}%=*}"
		if [[ "$name" == "$line" ]]; then

		fi
		directories=(${(z)line#*\# })
		for dir in "${directories[@]}"; do
			if [[ "$PWD" =~ "$dir" ]]; then
				echo "$name"
				return
			fi
		done
	done < "$1"
}

export DEFAULT_IFS="$IFS"
function chpwd() {
	_task_context $(_contexts_parser ~/.local/share/tasks/contexts.txt)
}
chpwd

